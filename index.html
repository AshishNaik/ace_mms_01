<!DOCTYPE html>
<html>
<head>
	<title>Ace Watch</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<meta http-equiv="cache-control" content="max-age=0" /> 
	<meta http-equiv="cache-control" content="no-cache" /> 
	<meta http-equiv="expires" content="0" /> 
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" /> 
	<meta http-equiv="pragma" content="no-cache" /> 
	
	<link rel="stylesheet" href="./assets/css/jquery.mobile-1.4.2.css" />
	<script src="./assets/js/jquery-1.10.2.min.js"></script>
	<script src="./assets/js/jquery.mobile-1.4.2.min.js"></script>
	<script>
	<!--
	var timeout=null;
	var mdtimeout=null;
	var	url_addr="http://www1.aceindia.com/interface/datawriter.php?";
	//var	url_addr="./ServerData.xml?";
	var	sortid=15;//Deafult Volume Desc
	var sortid2=5;//Default Volume Desc
	var prvdt;
	var curdt;
	var u_addr="";

	$(document).ready(function()
	{
		$("#esrt").attr("src", "assets/img/blk.png");
		$("#lsrt").attr("src", "assets/img/blk.png");
		$("#csrt").attr("src", "assets/img/blk.png");
		$("#gsrt").attr("src", "assets/img/blk.png");
		$("#vsrt").attr("src", "assets/img/down.png");
		$("#osrt").attr("src", "assets/img/blk.png");

		$("#esrt2").attr("src", "assets/img/blk.png");
		$("#lsrt2").attr("src", "assets/img/blk.png");
		$("#csrt2").attr("src", "assets/img/blk.png");
		$("#gsrt2").attr("src", "assets/img/blk.png");

		$("#dwn").attr("src", "assets/img/downr1.png");

		t=setTimeout(function() {getDataS();return;}, 500);

	});

	function sortdata_c()
	{
		$("#lsrt").attr("src", "assets/img/blk.png");
		$("#gsrt").attr("src", "assets/img/blk.png");
		$("#csrt").attr("src", "assets/img/blk.png");
		$("#esrt").attr("src", "assets/img/blk.png");
		$("#vsrt").attr("src", "assets/img/blk.png");
		$("#osrt").attr("src", "assets/img/blk.png");
		if(sortid==0)
		{
			$("#csrt").attr("src", "assets/img/down.png");
			sortid=1;
		}
		else if(sortid==1)
		{
			$("#esrt").attr("src", "assets/img/up.png");
			sortid=2;
		}
		else if(sortid==2)
		{
			$("#esrt").attr("src", "assets/img/down.png");
			sortid=3;
		}
		else if(sortid==3)
		{
			$("#csrt").attr("src", "assets/img/up.png");
			sortid=0;
		}
		else
		{
			$("#esrt").attr("src", "assets/img/up.png");
			sortid=2;
		}
		getDataS();
	}

	function sortdata_l()
	{
		$("#lsrt").attr("src", "assets/img/blk.png");
		$("#gsrt").attr("src", "assets/img/blk.png");
		$("#csrt").attr("src", "assets/img/blk.png");
		$("#esrt").attr("src", "assets/img/blk.png");
		$("#vsrt").attr("src", "assets/img/blk.png");
		$("#osrt").attr("src", "assets/img/blk.png");
		if(sortid==4)
		{
			$("#lsrt").attr("src", "assets/img/down.png");
			sortid=5;
		}
		else if(sortid==5)
		{
			$("#gsrt").attr("src", "assets/img/up.png");
			sortid=8;
		}
		else if(sortid==8)
		{
			$("#gsrt").attr("src", "assets/img/down.png");
			sortid=9;
		}
		else if(sortid==9)
		{
			$("#lsrt").attr("src", "assets/img/up.png");
			sortid=4;
		}
		else
		{
			$("#lsrt").attr("src", "assets/img/down.png");
			sortid=5;
		}
		getDataS();
	}

	function sortdata_v()
	{
		$("#lsrt").attr("src", "assets/img/blk.png");
		$("#gsrt").attr("src", "assets/img/blk.png");
		$("#csrt").attr("src", "assets/img/blk.png");
		$("#esrt").attr("src", "assets/img/blk.png");
		$("#vsrt").attr("src", "assets/img/blk.png");
		$("#osrt").attr("src", "assets/img/blk.png");
		if(sortid==14)
		{
			$("#vsrt").attr("src", "assets/img/down.png");
			sortid=15;
		}
		else if(sortid==15)
		{
			$("#osrt").attr("src", "assets/img/up.png");
			sortid=16;
		}
		else if(sortid==16)
		{
			$("#osrt").attr("src", "assets/img/down.png");
			sortid=17;
		}
		else if(sortid==17)
		{
			$("#vsrt").attr("src", "assets/img/up.png");
			sortid=14;
		}
		else
		{
			$("#vsrt").attr("src", "assets/img/down.png");
			sortid=15;
		}
		getDataS();
	}

	function sortdata_c2()
	{
		$("#lsrt2").attr("src", "assets/img/blk.png");
		$("#gsrt2").attr("src", "assets/img/blk.png");
		$("#csrt2").attr("src", "assets/img/blk.png");
		$("#esrt2").attr("src", "assets/img/blk.png");
		if(sortid2==0)
		{
			$("#csrt2").attr("src", "assets/img/down.png");
			sortid2=1;
		}
		else if(sortid2==1)
		{
			$("#esrt2").attr("src", "assets/img/up.png");
			sortid2=2;
		}
		else if(sortid2==2)
		{
			$("#esrt2").attr("src", "assets/img/down.png");
			sortid2=3;
		}
		else if(sortid2==3)
		{
			$("#csrt2").attr("src", "assets/img/up.png");
			sortid2=0;
		}
		else
		{
			$("#esrt2").attr("src", "assets/img/up.png");
			sortid2=2;
		}
		getDataS();
	}

	function sortdata_l2()
	{
		$("#lsrt2").attr("src", "assets/img/blk.png");
		$("#gsrt2").attr("src", "assets/img/blk.png");
		$("#csrt2").attr("src", "assets/img/blk.png");
		$("#esrt2").attr("src", "assets/img/blk.png");
		if(sortid2==4)
		{
			$("#lsrt2").attr("src", "assets/img/down.png");
			sortid2=5;
		}
		else if(sortid2==5)
		{
			$("#lsrt2").attr("src", "assets/img/up.png");
			sortid2=4;
		}
		else
		{
			$("#lsrt2").attr("src", "assets/img/down.png");
			sortid2=5;
		}
		getDataS();
	}

	function sortdata_g2()
	{
		$("#lsrt2").attr("src", "assets/img/blk.png");
		$("#gsrt2").attr("src", "assets/img/blk.png");
		$("#csrt2").attr("src", "assets/img/blk.png");
		$("#esrt2").attr("src", "assets/img/blk.png");
		if(sortid2==9)
		{
			$("#gsrt2").attr("src", "assets/img/up.png");
			sortid2=8;
		}
		else if(sortid2==8)
		{
			$("#gsrt2").attr("src", "assets/img/down.png");
			sortid2=9;
		}
		else
		{
			$("#gsrt2").attr("src", "assets/img/up.png");
			sortid2=8;
		}
		getDataS();
	}

	function getDataS()
	{
		u_addr="";
		
		if($.mobile.activePage.attr('id')=="pg2")
		{
			sortid=sortid2;
		}

		u_addr = url_addr+"&SO="+sortid;

		$.ajax({
		 type: "GET",
		 url: u_addr,
		 cache: "false",
		 dataType: "xml",
		 beforeSend:function(){
		 $('#output').html('<div class="loading"><br><br><br><br><br><br><br><center><span><img src="assets/img/al.gif" alt="Loading..." /></span></center></div>');},
		 success: parseXml
		});

	}

	function getData()
	{
		u_addr="";
		if($.mobile.activePage.attr('id')=="pg2")
		{
			sortid=sortid2;
		}
		var e1 = document.getElementById("seltyp1");
		var selval1 = e1.options[e1.selectedIndex].value;
		var e2 = document.getElementById("seltyp2");
		var selval2 = e2.options[e2.selectedIndex].value;
		
		var qrystr1="";
		if(selval1!="All")
		{
		  qrystr1="Typ="+selval1;
		}
		var qrystr2="";
		if(selval2!="All")
		{
		  qrystr2="OS="+selval2;
		}
		u_addr = url_addr+"&"+qrystr1+"&"+qrystr2;
		//alert(""+u_addr);

		$.ajax({
		 type: "GET",
		 url: u_addr,
		 cache: "false",
		 dataType: "xml",		
		 success: parseXml
		});
	}

	function showLV()
	{
		$.mobile.changePage( "#pg1", { transition: "slide"} );		
		t=setTimeout(function() {getData();return;}, 100);
	}

	function showGV()
	{
		$.mobile.changePage( "#pg2", { transition: "slide"} );
		t=setTimeout(function() {getData();return;}, 100);
	}

	function parseXml(xml)
	{
		 var $row;
		 var $out="";
		 var date;
		 var date_str="";
		 var time_str="";
		 var $cpu_chg="val_nochg";
		 var $mem_chg="val_nochg";
		 var $cpu_chg_val="";
		 var $mem_chg_val="";
		 var $data=null;

		 $data = $(xml).find("data");
		 var $row_arr=[];
		 $data.find("row").each(function()
		 {
			$row_arr[$row_arr.length] = $(this);
		 });
		 $out="";
		 for(var index = 0; index < $row_arr.length; ) {			
			$out+="<div class='ui-grid-z' data-theme='c'>";			
			if($.mobile.activePage.attr('id')=="pg2")
			{				
				if($row_arr[index+0]!=null)
				{
					$out+="<div class='ui-block-a'><div class='no_edge'><div class='";
					if(($row_arr[index+0].find("Sts").text())=="Up")
					{
						$out+="upsrv";
					}
					else
					{
						$out+="downsrv";
					}					$out+="'><br>&nbsp;&nbsp;&nbsp;<b>"+$row_arr[index+0].find("Ser").text()+"</b><br>&nbsp;&nbsp;&nbsp;CPU:"+$row_arr[index+0].find("CPU").text()+"<br>&nbsp;&nbsp;&nbsp;Mem:"+$row_arr[index+0].find("Mem").text()+"<br>&nbsp;&nbsp;&nbsp;"+$row_arr[index+0].find("Dsk").text()+"</div></div></div>"; 
					
				}
				if($row_arr[index+1]!=null)
				{
					$out+="<div class='ui-block-b'><div class='no_edge'><div class='";
					if(($row_arr[index+1].find("Sts").text())=="Up")
					{
						$out+="upsrv";
					}
					else
					{
						$out+="downsrv";
					}
					$out+="'><br>&nbsp;&nbsp;&nbsp;<b>"+$row_arr[index+1].find("Ser").text()+"</b><br>&nbsp;&nbsp;&nbsp;CPU:"+$row_arr[index+1].find("CPU").text()+"<br>&nbsp;&nbsp;&nbsp;Mem:"+$row_arr[index+1].find("Mem").text()+"<br>&nbsp;&nbsp;&nbsp;"+$row_arr[index+1].find("Dsk").text()+"</div></div></div>"; 
				}
				if($row_arr[index+2]!=null)
				{
					$out+="<div class='ui-block-c'><div class='no_edge'><div class='";
					if(($row_arr[index+2].find("Sts").text())=="Up")
					{
						$out+="upsrv";
					}
					else
					{
						$out+="downsrv";
					}					$out+="'><br>&nbsp;&nbsp;&nbsp;<b>"+$row_arr[index+2].find("Ser").text()+"</b><br>&nbsp;&nbsp;&nbsp;CPU:"+$row_arr[index+2].find("CPU").text()+"<br>&nbsp;&nbsp;&nbsp;Mem:"+$row_arr[index+2].find("Mem").text()+"<br>&nbsp;&nbsp;&nbsp;"+$row_arr[index+2].find("Dsk").text()+"</div></div></div>"; 
				}
				if($row_arr[index+3]!=null)
				{
					$out+="<div class='ui-block-d'><div class='no_edge'><div class='";
					if(($row_arr[index+3].find("Sts").text())=="Up")
					{
						$out+="upsrv";
					}
					else
					{
						$out+="downsrv";
					}
					$out+="'><br>&nbsp;&nbsp;&nbsp;<b>"+$row_arr[index+3].find("Ser").text()+"</b><br>&nbsp;&nbsp;&nbsp;CPU:"+$row_arr[index+3].find("CPU").text()+"<br>&nbsp;&nbsp;&nbsp;Mem:"+$row_arr[index+3].find("Mem").text()+"<br>&nbsp;&nbsp;&nbsp;"+$row_arr[index+3].find("Dsk").text()+"</div></div></div>"; 
				}
				if($row_arr[index+4]!=null)
				{
					$out+="<div class='ui-block-e'><div class='no_edge'><div class='";
					if(($row_arr[index+4].find("Sts").text())=="Up")
					{
						$out+="upsrv";
					}
					else
					{
						$out+="downsrv";
					}					$out+="'><br>&nbsp;&nbsp;&nbsp;<b>"+$row_arr[index+4].find("Ser").text()+"</b><br>&nbsp;&nbsp;&nbsp;CPU:"+$row_arr[index+4].find("CPU").text()+"<br>&nbsp;&nbsp;&nbsp;Mem:"+$row_arr[index+4].find("Mem").text()+"<br>&nbsp;&nbsp;&nbsp;"+$row_arr[index+4].find("Dsk").text()+"</div></div></div>"; 
				}
				index=index+5;			
			}
			
			else if($.mobile.activePage.attr('id')=="pg1")
			{
				$row = $(this);
				$cpu_chg_val=$row_arr[index].find("CTL").text();
				$mem_chg_val=$row_arr[index].find("MTL").text();

				if($cpu_chg_val > 0)
				{
					$cpu_chg = "val_th"+$cpu_chg_val;
				}
				if($mem_chg_val > 0)
				{
					$mem_chg = "val_th"+$mem_chg_val;
				}
				if($row_arr[index].find("Sts").text()=="Up")
				{
					$out+="<div class='ui-grid-z' data-theme='c'>";
					$out+="<div class='ui-block-a'><div class='topleftedge'><div class='val_nochg2' align='left'><b>"+$row_arr[index].find("Ser").text()+"</b></div></div></div>"; 
					$out+="<div class='ui-block-b'><div class='topleftedge'><div class='"+$cpu_chg+"' align='right'><b>"+$row_arr[index].find("CPU").text()+"</b></div></div></div>"; 
					$out+="<div class='ui-block-c'><div class='topleftedge'><div class='"+$mem_chg+"' align='right'><b>"+$row_arr[index].find("Mem").text()+"</b></div></div></div>"; 
					$out+="<div class='ui-block-d'><div class='topleftedge'><div class='val_nochg2' align='leftt'><b>"+$row_arr[index].find("Typ").text()+"</b></div></div></div>";	
					$out+="<div class='ui-block-e'><div class='topleftedge'><div class='val_nochg2' align='right'><b>"+$row_arr[index].find("LUT").text()+"</b></div></div></div>"; 
					$out+="</div>";	
				}
				else
				{					
					$out+="<div class='ui-grid-z' data-theme='c'>";
					$out+="<div class='ui-block-a'><div class='topleftedge'><div class='val_th9' align='left'><b>"+$row_arr[index].find("Ser").text()+"</b></div></div></div>"; 
					$out+="<div class='ui-block-b'><div class='topleftedge'><div align='center'><b>NA</b></div></div></div>"; 
					$out+="<div class='ui-block-c'><div class='topleftedge'><div align='center'><b>NA</b></div></div></div>"; 
					$out+="<div class='ui-block-d'><div class='topleftedge'><div align='leftt'><b>"+$row_arr[index].find("Typ").text()+"</b></div></div></div>";	
					$out+="<div class='ui-block-e'><div class='topleftedge'><div align='right'><b>"+$row_arr[index].find("LUT").text()+"</b></div></div></div>"; 
					$out+="</div>";	
					
				}
				index++;
			}
			
			$out+="</div>";	
		 }


		 

		if($.mobile.activePage.attr('id')=="pg2")
		{
			$out+="<div class='ui-grid-z' data-theme='c'>";
			$out+="<div class='ui-block-a'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-b'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-c'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-d'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-e'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>";			
			$out+="</div>";	
			
			$("#output2").html($out);
			date = $(xml).find("as_on").text();
			//alert("dt:"+date);
			$("#dt2").html(""+date);

		}
		else if($.mobile.activePage.attr('id')=="pg1")
		{
			$out+="<div class='ui-grid-z' data-theme='c'>";
			$out+="<div class='ui-block-a'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-b'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-c'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-d'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>"; 
			$out+="<div class='ui-block-e'><div class='topedge'><div align='right'><b>&nbsp;</b></div></div></div>";			
			$out+="</div>";	
			$("#output1").html($out);
			date = $(xml).find("as_on").text();
			$("#dt").html(""+date);
		 }
		 $xml=null;

		 clearTimeout(timeout);
		 timeout=setTimeout(function() {getData();return;}, 2000);
	}

	

	//-->
	</script>

</head>

<body> 
<div data-role="page" data-theme="c" id="pg2">

	<div data-role="header" data-position="fixed" data-theme="c">
		<div data-role="header" data-theme="z">		 
			<div id="dt2" class="ui-btn-left"></div><h2><b>Ace Monitoring system</b></h2><a href="#" onClick="showLV()" data-theme="a" class="ui-btn-right">List View</a></div>
			<div data-role="header" data-theme="c" align="centre">
			<div><form>
				<div style="float:left;vertical-align:middle;"><div>Type:&nbsp;</div></div>
				<div style="float:left;">
					<select id="seltyp1" >
					  <option value="All">All</option>
					  <option value="Production">PROD</option>
					  <option value="DR">DR</option>
					  <option value="UAT">UAT</option>
					</select>
				</div>
				<div style="float:left;"><div>&nbsp;OS:&nbsp;</div></div>
				<div style="float:left;">
					<select id="seltyp2">
					  <option value="All">All</option>
					  <option value="SOLARIS">SOLARIS</option>
					  <option value="LINUX">LINUX</option>
					  <option value="WINDOWS">WINDOWS</option>
					</select>
				</div>
			</form>
			</div>
		</div>
	</div><!--header-->

	<div data-role="content">
		<div id="output2"></div>
	</div><!--content-->

</div><!--page-->


<div data-role="page" data-theme="c" id="pg1">
	<div data-role="header" data-position="fixed" data-theme="c">
		<div data-role="header" data-theme="z">		 
			<div id="dt2" class="ui-btn-left"></div><h2><b>Ace Monitoring system</b></h2><a href="#" onClick="showGV()" data-theme="a" class="ui-btn-right">Grid View</a></div>
			<div data-role="header" class="ui-grid-z6" data-theme="c">
			<div class="ui-block-a"><a class="pglink" href='#' onClick='Javascript:sortdata_c2()'><div class="pglink" align='left'><img id='csrt2'>&nbsp;<b>Server</b></div></a></div>
			<div class="ui-block-b"><div align='center'><b>CPU</b><br>&nbsp;</div></div>
			<div class="ui-block-c"><div align='center'><b>Memory</b><br>&nbsp;</div></div>
			<div class="ui-block-d"><a class="pglink" href='#' onClick='Javascript:sortdata_l2()'><div class="pglink" align='center'><img id='lsrt2'>&nbsp;<b>Type</b><br>&nbsp;</div></a></div>
			<div class="ui-block-e"><a class="pglink" href='#' onClick='Javascript:sortdata_g2()'><div class="pglink" align='center'><img id='gsrt2'>&nbsp;<b>Last Updated</b>&nbsp;<br></div></a></div>			
		</div>
	</div><!--header-->

	<div data-role="content">
		<div id="output1"></div>
	</div><!--content-->

</div><!--page-->
</body>
</html>


